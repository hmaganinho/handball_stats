<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handball Stats Elite v10.0</title>
    <style>
        :root {
            --verde: #28a745; --vermelho: #dc3545; --azul: #007bff;
            --laranja: #fd7e14; --amarelo: #ffc107; --cinza: #333; --escuro: #000;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #111; color: white; padding-bottom: 50px; text-align: center; }
        
        /* HEADER E KPIs */
        #topo { position: sticky; top: 0; z-index: 100; background: var(--escuro); box-shadow: 0 4px 15px rgba(0,0,0,0.8); border-bottom: 1px solid #333; }
        #marcador { display: flex; justify-content: space-around; align-items: center; padding: 10px; }
        .score { font-size: 36px; font-weight: bold; font-family: monospace; }
        #tempo { font-size: 24px; color: var(--amarelo); font-family: monospace; }

        #equipa-stats { display: flex; gap: 4px; padding: 10px; background: #222; }
        .btn-destaque { flex: 1; padding: 10px 2px; border-radius: 5px; background: var(--azul); text-align: center; }
        .val-destaque { display: block; font-size: 18px; font-weight: bold; }
        .label-destaque { display: block; font-size: 9px; opacity: 0.9; text-transform: uppercase; }

        section { padding: 12px; border-bottom: 1px solid #333; max-width: 500px; margin: 0 auto; }
        h3 { font-size: 11px; color: #777; text-transform: uppercase; margin: 5px 0; }

        /* GRELHA JOGADORES (RET√ÇNGULOS 4x4) */
        .grid-jogadores { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .btn-jogador { 
            background: var(--cinza); border: 2px solid #444; 
            height: 60px; font-size: 24px; font-weight: bold;
            color: white; border-radius: 6px; position: relative;
            opacity: 0.3; transition: 0.2s;
        }
        .btn-jogador.no-campo { opacity: 1; border-color: var(--verde); box-shadow: inset 0 0 10px var(--verde); }
        .btn-jogador.is-gr { background: #6f42c1; }
        .btn-jogador.selecionado { background: var(--azul) !important; opacity: 1 !important; border-color: #fff !important; transform: scale(1.05); }
        .cipa-label { position: absolute; top: 2px; left: 2px; font-size: 7px; opacity: 0.6; color: #fff; }

        /* STAFF */
        .grid-staff { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .btn-staff { background: #444; padding: 12px; font-size: 12px; border: 1px solid #666; color: white; border-radius: 6px; }
        .btn-staff.selecionado { background: var(--azul) !important; border-color: #fff; }

        /* CONTROLO */
        .linha-controlo { display: flex; gap: 8px; margin-bottom: 10px; }
        .btn-fluxo { flex: 1; padding: 15px; font-size: 14px; font-weight: bold; border-radius: 8px; border: 2px solid #444; background: #222; color: white; cursor: pointer; }
        .btn-fluxo.ativo { background: var(--verde); border-color: white; }

        /* ZONAS E A√á√ïES (Fonte 21px) */
        .grid-zonas { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .btn-zona { background: var(--azul); padding: 18px 0; font-size: 21px; font-weight: bold; border-radius: 4px; color: white; border: none; }
        .btn-zona.selecionada { background: #fff; color: var(--azul); outline: 2px solid var(--azul); }

        .grid-acoes { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-acao { padding: 18px 5px; font-size: 21px; font-weight: bold; border-radius: 6px; color: white; border: none; text-transform: uppercase; }

        /* MODAL CIPA */
        #custom-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #222; padding: 30px; border-radius: 12px; border: 1px solid #444; width: 80%; max-width: 300px; }
        .modal-btns { display: flex; gap: 10px; margin-top: 20px; }
        .btn-modal { flex: 1; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }

        /* DASHBOARD */
        .container-tabela { width: 100%; overflow-x: auto; margin-top: 10px; background: #111; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 10px; }
        th { background: #222; padding: 8px; color: #888; }
        td { padding: 8px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<div id="topo">
    <div id="marcador">
        <div class="score" id="p-nos">0</div>
        <div style="text-align:center">
            <div id="tempo">00:00</div>
            <button onclick="toggleTempo()" id="btn-timer" style="background:#333; color:white; padding:5px 15px; border-radius:4px; font-size:10px; border: 1px solid #555;">START JOGO</button>
        </div>
        <div class="score" id="p-eles">0</div>
    </div>
    <div id="equipa-stats">
        <div class="btn-destaque"><span class="label-destaque">EO</span><span class="val-destaque" id="eo-val">0%</span></div>
        <div class="btn-destaque" style="background:#5c6bc0;"><span class="label-destaque">ED</span><span class="val-destaque" id="ed-val">0%</span></div>
        <div class="btn-destaque"><span class="label-destaque">FT / AD</span><span class="val-destaque" id="ft-ad-val">0 / 0</span></div>
    </div>
</div>

<div id="resumo-selecao" style="background:#1a1a1a; padding:10px; color:var(--amarelo); font-size:14px; font-weight:bold;">JOGADOR: -- | ZONA: --</div>

<section>
    <div class="linha-controlo">
        <button id="btn-7-inicial" class="btn-fluxo" onclick="ativarModo('7inicial')">üìã 7 INICIAL</button>
        <button id="btn-sub" class="btn-fluxo" onclick="ativarModo('sub')">üîÑ SUBSTITUI√á√ÉO</button>
    </div>
    <div class="grid-jogadores" id="grid-main"></div>
    <div class="grid-staff">
        <button class="btn-staff" id="btn-staff-treinador" onclick="cliqueJogador('TREINADOR')">TREINADOR</button>
        <button class="btn-staff" id="btn-staff-dirigente" onclick="cliqueJogador('DIRIGENTE')">DIRIGENTE</button>
    </div>
</section>

<section>
    <h3>Zonas</h3>
    <div class="grid-zonas">
        <button class="btn-zona" onclick="selecionarZona('PE', this)">PE</button>
        <button class="btn-zona" onclick="selecionarZona('PV', this)">PV</button>
        <button class="btn-zona" onclick="selecionarZona('PD', this)">PD</button>
        <button class="btn-zona" onclick="selecionarZona('LE', this)">LE</button>
        <button class="btn-zona" onclick="selecionarZona('CT', this)">CT</button>
        <button class="btn-zona" onclick="selecionarZona('LD', this)">LD</button>
        <button class="btn-zona" style="grid-column: span 3; margin-top:5px;" onclick="selecionarZona('7 METROS', this)">7 METROS</button>
    </div>
</section>

<section>
    <div class="grid-acoes">
        <button class="btn-acao" style="background:var(--verde)" onclick="registar('Golo Marcado')">Golo Marcado</button>
        <button class="btn-acao" style="background:var(--vermelho)" onclick="registar('Remate Falhado')">Remate Falhado</button>
        <button class="btn-acao" style="background:var(--verde)" onclick="registar('A√ß√£o Defensiva')">A√ß√£o Defensiva</button>
        <button class="btn-acao" style="background:var(--vermelho)" onclick="registar('Falha T√©cnica')">Falha T√©cnica</button>
        <button class="btn-acao" style="background:var(--amarelo); color:black" onclick="registar('C. Amarelo')">C. Amarelo</button>
        <button class="btn-acao" style="background:var(--laranja)" onclick="registar('2 Minutos')">2 Minutos</button>
        <button class="btn-acao" style="background:var(--vermelho); grid-column: span 2;" onclick="registar('Cart√£o Vermelho')">Cart√£o Vermelho</button>
    </div>
</section>

<section>
    <h3>Dashboard Individual</h3>
    <div class="container-tabela">
        <table>
            <thead><tr><th>N¬∫</th><th>EO%</th><th>GM</th><th>RF</th><th>AD</th><th>FT</th><th>7M M/F</th></tr></thead>
            <tbody id="corpo-stats"></tbody>
        </table>
    </div>
</section>

<section style="display: flex; gap: 8px;">
    <button onclick="anularUltimo()" style="background:#444; flex: 1; padding:15px; border-radius:8px; border:none; color:white; font-weight:bold;">‚Ü© ANULAR</button>
    <button onclick="exportarCSV()" style="background:var(--verde); flex: 1; padding:15px; border-radius:8px; border:none; color:white; font-weight:bold;">üíæ EXCEL</button>
    <button onclick="enviarWhatsApp()" style="background:#25D366; flex: 1; padding:15px; border-radius:8px; border:none; color:white; font-weight:bold;">üì± WA</button>
</section>

<div id="custom-modal">
    <div class="modal-content">
        <p>√â Guarda-Redes?</p>
        <div class="modal-btns">
            <button class="btn-modal" style="background:var(--verde); color:white" onclick="confirmModal(true)">SIM</button>
            <button class="btn-modal" style="background:var(--vermelho); color:white" onclick="confirmModal(false)">N√ÉO</button>
        </div>
    </div>
</div>

<script>
// --- MOTOR ---
let jogadores = {}; 
const staffNames = ["TREINADOR", "DIRIGENTE"];
for(let i=1; i<=16; i++) jogadores[i] = { cipa: "------", isGR: false, noCampo: false, gm:0, rf:0, ad:0, ft:0, am:0, m2:0, cv:0, m7m:0, m7f:0, rd:0, gs:0 };
staffNames.forEach(s => jogadores[s] = { cipa: "---", isGR: false, noCampo: true, gm:0, rf:0, ad:0, ft:0, am:0, m2:0, cv:0, m7m:0, m7f:0, rd:0, gs:0 });

let historico = [], jAtivo = null, zAtiva = null, modoAtual = 'scout', segs = 0, timerInterval = null, jogoIniciado = false, tempNum = null, timerSub = null;

const container = document.getElementById('grid-main');
for(let i=1; i<=16; i++) {
    const btn = document.createElement('button');
    btn.className = 'btn-jogador'; btn.id = `btn-j-${i}`;
    btn.innerHTML = `<span class="cipa-label" id="cipa-${i}"></span>${i}`;
    btn.onclick = () => cliqueJogador(i);
    container.appendChild(btn);
}

function ativarModo(modo) {
    modoAtual = (modoAtual === modo) ? 'scout' : modo;
    document.getElementById('btn-7-inicial').classList.toggle('ativo', modoAtual === '7inicial');
    document.getElementById('btn-sub').classList.toggle('ativo', modoAtual === 'sub');
    if(modoAtual === 'sub') startTimerSub();
}

function startTimerSub() {
    if(timerSub) clearTimeout(timerSub);
    timerSub = setTimeout(() => { modoAtual = 'scout'; ativarModo('scout'); }, 5000);
}

function cliqueJogador(num) {
    if(!jogoIniciado && modoAtual === 'scout') {
        const c = prompt(`CIPA do N¬∫ ${num}:`, jogadores[num].cipa);
        if(c) { jogadores[num].cipa = c; document.getElementById(`cipa-${num}`).innerText = c; tempNum = num; document.getElementById('custom-modal').style.display = 'flex'; }
        return;
    }
    if(modoAtual === '7inicial' || modoAtual === 'sub') {
        if(typeof num === 'number') {
            const ativos = Object.values(jogadores).filter(j => j.noCampo && j.cipa !== "---").length;
            // Valida√ß√£o de limite: Se tentar ativar e j√° houver 7, bloqueia.
            if(!jogadores[num].noCampo && ativos >= 7) { alert("Limite de 7 jogadores atingido!"); return; }
            jogadores[num].noCampo = !jogadores[num].noCampo;
            document.getElementById(`btn-j-${num}`).classList.toggle('no-campo', jogadores[num].noCampo);
            if(modoAtual === 'sub') startTimerSub();
        }
    } else {
        document.querySelectorAll('.btn-jogador, .btn-staff').forEach(b => b.classList.remove('selecionado'));
        if(jAtivo === num) jAtivo = null; else { jAtivo = num; (typeof num === 'number' ? document.getElementById(`btn-j-${num}`) : document.getElementById(`btn-staff-${num.toLowerCase()}`)).classList.add('selecionado'); }
        atualizarLabel();
    }
}

function confirmModal(res) { jogadores[tempNum].isGR = res; document.getElementById(`btn-j-${tempNum}`).classList.toggle('is-gr', res); document.getElementById('custom-modal').style.display = 'none'; }

function selecionarZona(nome, btn) {
    document.querySelectorAll('.btn-zona').forEach(b => { b.style.background = 'var(--azul)'; b.style.color = 'white'; });
    if(zAtiva === nome) zAtiva = null; else { zAtiva = nome; btn.style.background = 'white'; btn.style.color = 'var(--azul)'; }
    atualizarLabel();
}

function atualizarLabel() { document.getElementById('resumo-selecao').innerText = `JOGADOR: ${jAtivo || '--'} | ZONA: ${zAtiva || '--'}`; }

function toggleTempo() {
    const ativos = Object.values(jogadores).filter(j => j.noCampo && j.cipa !== "---").length;
    if(!jogoIniciado && ativos < 7) { alert("Configure os 7 iniciais!"); return; }
    jogoIniciado = true;
    if(timerInterval) { clearInterval(timerInterval); timerInterval = null; document.getElementById('btn-timer').innerText = "RETOMAR"; }
    else { timerInterval = setInterval(() => { segs++; const m = Math.floor(segs/60).toString().padStart(2,'0'), s = (segs%60).toString().padStart(2,'0'); document.getElementById('tempo').innerText = `${m}:${s}`; }, 1000); document.getElementById('btn-timer').innerText = "PAUSAR"; }
}

function registar(acao) {
    if(!jAtivo) return alert("Selecione Jogador!");
    const disc = ["C. AMARELO", "2 MINUTOS", "CART√ÉO VERMELHO", "FALHA T√âCNICA", "A√á√ÉO DEFENSIVA"].includes(acao.toUpperCase());
    if(!disc && !zAtiva) return alert("Selecione Zona!");
    const j = jogadores[jAtivo];
    if(acao === "Golo Marcado") { j.gm++; if(zAtiva === "7 METROS" && !j.isGR) j.m7m++; }
    else if(acao === "Remate Falhado") { j.rf++; if(zAtiva === "7 METROS" && !j.isGR) j.m7f++; }
    else if(acao === "A√ß√£o Defensiva") j.ad++; else if(acao === "Falha T√©cnica") j.ft++;
    else if(acao === "C. Amarelo") j.am++; else if(acao === "2 Minutos") j.m2++; else if(acao === "Cart√£o Vermelho") j.cv++;
    historico.unshift({ j: jAtivo, a: acao, t: document.getElementById('tempo').innerText, z: zAtiva || "---" });
    atualizarTudo(); resetScout();
}

function atualizarTudo() {
    let tGM = 0, tRF = 0, tFT = 0, tAD = 0, maxG = 0, mvp = "--";
    const corpo = document.getElementById('corpo-stats'); corpo.innerHTML = "";
    for(let i in jogadores) {
        const j = jogadores[i];
        if(!staffNames.includes(i)) { tGM += j.gm; tRF += j.rf; tFT += j.ft; tAD += j.ad; if(j.gm > maxG) { maxG = j.gm; mvp = i; } }
        if(j.gm + j.rf + j.ad + j.ft + j.am + j.m2 > 0) {
            const eo = (j.gm + j.rf + j.ft) > 0 ? Math.round((j.gm / (j.gm + j.rf + j.ft)) * 100) : 0;
            corpo.innerHTML += `<tr><td>${i}</td><td>${eo}%</td><td>${j.gm}</td><td>${j.rf}</td><td>${j.ad}</td><td>${j.ft}</td><td>${j.m7m}/${j.m7f}</td></tr>`;
        }
    }
    document.getElementById('p-nos').innerText = tGM;
    document.getElementById('eo-val').innerText = ((tGM + tRF + tFT) > 0 ? Math.round((tGM / (tGM + tRF + tFT)) * 100) : 0) + "%";
    document.getElementById('ft-ad-val').innerText = `${tFT} / ${tAD}`;
    window.mvpData = { name: mvp, goals: maxG };
}

function resetScout() { jAtivo = null; zAtiva = null; document.querySelectorAll('.btn-jogador, .btn-staff').forEach(b => b.classList.remove('selecionado')); document.querySelectorAll('.btn-zona').forEach(b => { b.style.background = 'var(--azul)'; b.style.color = 'white'; }); atualizarLabel(); }

function anularUltimo() { if(historico.length === 0) return; const u = historico.shift(), j = jogadores[u.j]; if(u.a === "Golo Marcado") { j.gm--; if(u.z === "7 METROS") j.m7m--; } else if(u.a === "Remate Falhado") { j.rf--; if(u.z === "7 METROS") j.m7f--; } else if(u.a === "A√ß√£o Defensiva") j.ad--; else if(u.a === "Falha T√©cnica") j.ft--; else if(u.a === "C. Amarelo") j.am--; else if(u.a === "2 Minutos") j.m2--; else if(u.a === "Cart√£o Vermelho") j.cv--; atualizarTudo(); }

function exportarCSV() { let csv = "Tempo;Camisola;CIPA;Acao\n"; historico.forEach(e => { csv += `${e.t};${e.j};${jogadores[e.j].cipa};${e.a}\n`; }); const blob = new Blob([csv], { type: 'text/csv' }), url = window.URL.createObjectURL(blob), a = document.createElement('a'); a.href = url; a.download = 'scout_andebol.csv'; a.click(); }

function enviarWhatsApp() {
    const tGM = document.getElementById('p-nos').innerText, tGS = document.getElementById('p-eles').innerText, eo = document.getElementById('eo-val').innerText, ed = document.getElementById('ed-val').innerText;
    const msg = encodeURIComponent(`üìä *RESUMO ANDEBOL*\nüèÜ Placar: ${tGM} - ${tGS}\nüéØ Ataque (EO): ${eo}\nüõ°Ô∏è Defesa (ED): ${ed}\nüåü MVP: N¬∫ ${window.mvpData.name} (${window.mvpData.goals} golos)`);
    window.open(`https://wa.me/?text=${msg}`, '_blank');
}

atualizarTudo();
</script>
</body>
</html>
